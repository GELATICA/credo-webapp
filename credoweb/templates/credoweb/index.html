{% extends "credoweb/base.html" %}

{% load cache %}

{% block content %}

<div class="box">

    <div class="title"> api.credo.science </div>

        <div class="information">
        <div class="label">TODAY! Compete for Science</div>
        <p>
            1st World Championships in Particle Hunting! Start: May 18th 2018 (TODAY!), 16:20 CEST | Duration: 24h. <a
                href="https://api.credo.science/web/contest/?start=16:20&duration=1440">See the view, check the
            rules</a>, compete in teams, be the champion, beat the world record!"
        </p>
        </div>
    <div class="information">
        <div class="label">Quantum Gravity Previewer</div>
        <p>
            Join and follow the first CREDO online experiment: <a
                href="https://credo2.cyfronet.pl/redmine/projects/time/wiki/Wiki">Quantum Gravity Previewer</a> (for
            CREDO members only, minimum requirement to become a member: like the official <a
                href="https://www.facebook.com/credo.science/">CREDO FB profile</a>, then request membership by
            e-mail/FB).
        </p>
    </div>

    <div class="buttons">
        <ul>
            <li><a href="{% url 'detection_list' %}">Detections ( {{ global_stats.detections_total }} ) </a></li>
            <li><a href="{% url 'user_list' %}">Users ( {{ global_stats.users_total }} )</a></li>
            <li><a href="{% url 'team_list' %}">Teams ( {{ global_stats.teams_total }} )</a></li>
            <!-- <li><a href="">Maps</a></li> -->
        </ul>
    </div>


    <div class="panel">
        {% cache 3600 top_users_data %}
        <div class="panel-users">
            <!-- {{ time }} -->
            <div class="title"><i class="fas fa-chart-bar"></i> top 5 users</div>

            <table width="100%">
                <tr>
                    <th><i class="fas fa-sort"></i> Login</th>
                    <th><i class="fas fa-sort"></i> Detections</th>
                </tr>

                {% for user in top_users %}

                <tr>
                    <td><a href="{% url 'user_page' username=user.name %}">{{ user.display_name }}</a></td>
                    <td>{{ user.detection_count }}</td>
                </tr>

                {% endfor %}

            </table>
        </div>
        {% endcache %}


        {% cache 300 recent_users_data %}
        <div class="panel-users-registerd">
            <!-- {{ time }} -->
            <div class="title"><i class="fas fa-chart-bar"></i>5 registered users</div>
            <table width="100%">
                <tr>
                    <th><i class="fas fa-sort"></i> Login</th>
                    <th><i class="fas fa-sort"></i> Detections</th>
                </tr>

                {% for user in recent_users %}

                <tr>
                    <td><a href="{% url 'user_page' username=user.name %}">{{ user.display_name }}</a></td>
                    <td>{{ user.detection_count }}</td>
                </tr>

                {% endfor %}

            </table>
        </div>
        {% endcache %}

    </div>


    {% cache 120 recent_detections_data %}
    <div class="panel">
        <!-- {{ time }} -->
        <div class="title"><i class="fas fa-chart-bar"></i> Last 20 detections</div>
        <table>
            <tr>
                <th><i class="fas fa-sort"></i> date</th>
                <th><i class="fas fa-sort"></i> login</th>
                <th><i class="fas fa-sort"></i> team</th>
                <th><i class="fas fa-sort"></i> img</th>
            </tr>
            {% for detection in recent_detections %}
            <tr>
                <td width="30%"> {{ detection.date }}</td>
                <td><a href="{% url 'user_page' username=detection.user.name %}">{{ detection.user.display_name }}</a>
                </td>
                <td><a href="{% url 'team_page' name=detection.team.name %}">{{ detection.team.name }}</a></td>
                <td width="50px" align="center"><img style="display:block; width:30px;height:30px;"
                                                     src="data:image/png;base64,{{ detection.img }}" class="big_img">
                </td>
            </tr>
            {% endfor %}
        </table>

    </div>
    {% endcache %}

</div>

</div>

{% endblock %}
